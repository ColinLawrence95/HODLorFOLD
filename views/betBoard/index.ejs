<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Bet Board</title>
    </head>
    <body>
        <%- include('../partials/_navbar.ejs') %>
        <h1>Bet Board</h1>

        <form action="/betBoard/<%= user._id %>/newBet" method="GET">
            <button type="submit">New Bet</button>
        </form>

        <h1>Open Bets</h1>
        <% if (bets && bets.length > 0) { %> <% bets.forEach(bet => { %> <% if
        (!bet.betInProgress && !bet.betResolved && user._id !==
        bet.userId._id.toString()) { %>
        <p>
            <%= `${bet.userId.username} thinks ${bet.coinId} will be
            ${bet.betType} after ${bet.betLength}Hr and is wagering ${bet.wager} tokens!` %>
        </p>
        <form
            action="/betBoard/<%= user._id %>/acceptBet/<%= bet._id %>"
            method="POST"
        >
            <button type="submit">Accept Bet</button>
        </form>
        <% } %> <% }) %> <% } else { %>
        <p>No open bets available.</p>
        <% } %>

        <h1>Your Bets</h1>
        <% if (bets && bets.length > 0) { %> 
            <% bets.forEach(bet => { %> 
                <% if(user._id === bet.userId._id.toString() && !bet.betResolved || user._id === bet.betAcceptedBy && !bet.betResolved) { %>
                    <p><%=`${bet.userId.username} thinks ${bet.coinId} will be ${bet.betType} after ${bet.betLength}Hr and is wagering ${bet.wager} tokens!` %></p>
                <% } %> 
            <% }) %> 
        <% } else { %>
        <p>No bets posted or accepted yet.</p>
        <% } %>
    </body>
</html>
